(function(){var e=function(e){return e.reduce(function(e,t){return 2*e+t},0)},t=function(e){for(var t=[],r=7;r>=0;r--)t.push(!!(e&1<<r));return t},r=function(e){this.data=e,this.len=this.data.length,this.pos=0,this.readByte=function(){if(this.pos>=this.data.length)throw new Error("Attempted to read past end of stream.");return 255&e.charCodeAt(this.pos++)},this.readBytes=function(e){for(var t=[],r=0;e>r;r++)t.push(this.readByte());return t},this.read=function(e){for(var t="",r=0;e>r;r++)t+=String.fromCharCode(this.readByte());return t},this.readUnsigned=function(){var e=this.readBytes(2);return(e[1]<<8)+e[0]}},n=function(e,t){for(var r,n,a=0,i=function(e){for(var r=0,n=0;e>n;n++)t.charCodeAt(a>>3)&1<<(7&a)&&(r|=1<<n),a++;return r},o=[],s=1<<e,d=s+1,c=e+1,f=[],p=function(){f=[],c=e+1;for(var t=0;s>t;t++)f[t]=[t];f[s]=[],f[d]=null};;)if(n=r,r=i(c),r!==s){if(r===d)break;if(r<f.length)n!==s&&f.push(f[n].concat(f[r][0]));else{if(r!==f.length)throw new Error("Invalid LZW code.");f.push(f[n].concat(f[n][0]))}o.push.apply(o,f[r]),f.length===1<<c&&12>c&&c++}else p();return o},a=function(r,a){a||(a={});var i=function(e){for(var t=[],n=0;e>n;n++)t.push(r.readBytes(3));return t},o=function(){var e,t;t="";do e=r.readByte(),t+=r.read(e);while(0!==e);return t},s=function(){var n={};if(n.sig=r.read(3),n.ver=r.read(3),"GIF"!==n.sig)throw new Error("Not a GIF file.");n.width=r.readUnsigned(),n.height=r.readUnsigned();var o=t(r.readByte());n.gctFlag=o.shift(),n.colorRes=e(o.splice(0,3)),n.sorted=o.shift(),n.gctSize=e(o.splice(0,3)),n.bgColor=r.readByte(),n.pixelAspectRatio=r.readByte(),n.gctFlag&&(n.gct=i(1<<n.gctSize+1)),a.hdr&&a.hdr(n)},d=function(n){var i=function(n){var i=(r.readByte(),t(r.readByte()));n.reserved=i.splice(0,3),n.disposalMethod=e(i.splice(0,3)),n.userInput=i.shift(),n.transparencyGiven=i.shift(),n.delayTime=r.readUnsigned(),n.transparencyIndex=r.readByte(),n.terminator=r.readByte(),a.gce&&a.gce(n)},s=function(e){e.comment=o(),a.com&&a.com(e)},d=function(e){r.readByte();e.ptHeader=r.readBytes(12),e.ptData=o(),a.pte&&a.pte(e)},c=function(e){{var t=function(e){r.readByte();e.unknown=r.readByte(),e.iterations=r.readUnsigned(),e.terminator=r.readByte(),a.app&&a.app.NETSCAPE&&a.app.NETSCAPE(e)},n=function(e){e.appData=o(),a.app&&a.app[e.identifier]&&a.app[e.identifier](e)};r.readByte()}switch(e.identifier=r.read(8),e.authCode=r.read(3),e.identifier){case"NETSCAPE":t(e);break;default:n(e)}},f=function(e){e.data=o(),a.unknown&&a.unknown(e)};switch(n.label=r.readByte(),n.label){case 249:n.extType="gce",i(n);break;case 254:n.extType="com",s(n);break;case 1:n.extType="pte",d(n);break;case 255:n.extType="app",c(n);break;default:n.extType="unknown",f(n)}},c=function(s){var d=function(e,t){for(var r=new Array(e.length),n=e.length/t,a=function(n,a){var i=e.slice(a*t,(a+1)*t);r.splice.apply(r,[n*t,t].concat(i))},i=[0,4,2,1],o=[8,8,4,2],s=0,d=0;4>d;d++)for(var c=i[d];n>c;c+=o[d])a(c,s),s++;return r};s.leftPos=r.readUnsigned(),s.topPos=r.readUnsigned(),s.width=r.readUnsigned(),s.height=r.readUnsigned();var c=t(r.readByte());s.lctFlag=c.shift(),s.interlaced=c.shift(),s.sorted=c.shift(),s.reserved=c.splice(0,2),s.lctSize=e(c.splice(0,3)),s.lctFlag&&(s.lct=i(1<<s.lctSize+1)),s.lzwMinCodeSize=r.readByte();var f=o();s.pixels=n(s.lzwMinCodeSize,f),s.interlaced&&(s.pixels=d(s.pixels,s.width)),a.img&&a.img(s)},f=function(){var e={};switch(e.sentinel=r.readByte(),String.fromCharCode(e.sentinel)){case"!":e.type="ext",d(e);break;case",":e.type="img",c(e);break;case";":e.type="eof",a.eof&&a.eof(e);break;default:throw new Error("Unknown block: 0x"+e.sentinel.toString(16))}"eof"!==e.type&&setTimeout(f,0)},p=function(){s(),setTimeout(f,0)};p()};this.jsgif={},this.jsgif.Stream=r,this.jsgif.parseGIF=a}).call(this);
(function(){var t,e,i,s=function(t,e){return function(){return t.apply(e,arguments)}};this.GIFVideo=function(){function e(e,i){this.block=e,this.eofHandler=s(this.eofHandler,this),this.imgHandler=s(this.imgHandler,this),this.gceHandler=s(this.gceHandler,this),this.hdrHandler=s(this.hdrHandler,this),this.opts=i||{},this.opts.gif=this.block.getAttribute("data-src"),this.stream=this.hdr=this.transparency=null,this.delay=this.disposalMethod=this.lastDisposalMethod=null,this.frame=this.lastImg=null,this.disposalRestoreFromIdx=0,this.set_first_frame=!1,this.canvas=new t(this.block),this.frames=this.canvas.frames,this.tcanvas=this.canvas.tmp_canvas,this._loadGif()}return e.prototype._loadGif=function(){var t;return this.loading=!0,this.load_callback=function(){return console.log("call load_callback")},t=new XMLHttpRequest,t.overrideMimeType("text/plain; charset=x-user-defined"),t.onload=function(e){return function(){return e.stream=new jsgif.Stream(t.responseText),e._parse()}}(this),t.onprogress=function(){return function(){}}(this),t.onerror=function(t){return function(){return t.drawError("xhr")}}(this),t.open("GET",this.opts.gif,!0),t.send()},e.prototype._parse=function(){var t,e;e={hdr:this.hdrHandler,gce:this.gceHandler,com:function(){},app:{NETSCAPE:function(){}},img:this._getHandlerwithDrawProgress(this.imgHandler),eof:this.eofHandler};try{return jsgif.parseGIF(this.stream,e)}catch(i){return t=i,this.canvas.drawError("parse")}},e.prototype.hdrHandler=function(t){return this.hdr=t,this.canvas.setSize(this.hdr.width,this.hdr.height)},e.prototype.gceHandler=function(t){return this._pushFrame(),this.frame=null,this.delay=t.delayTime,this.transparency=t.transparencyIndex||null,this.disposalMethod=t.disposalMethod,this.lastDisposalMethod=this.disposalMethod},e.prototype._pushFrame=function(){return this.frame?(this.frames.addFrame({data:this.frame.getImageData(0,0,this.hdr.width,this.hdr.height),delay:this.delay}),this.set_first_frame?void 0:(this.canvas.drawFrame(0),this.set_first_frame=!0)):!0},e.prototype.imgHandler=function(t){return this.frame||(this.frame=this.tcanvas.getContext("2d")),this.frames.getLength()>0&&this._setDisposal(),this._setFrame(t),this.lastImg=t},e.prototype._setDisposal=function(){var t;return 3===this.lastDisposalMethod?(t=this.frames.getFrame(this.disposalRestoreFromIdx).data,this.frame.putImageData(t,0,0)):2===this.lastDisposalMethod?this.frame.clearRect(this.lastImg.leftPos,this.lastImg.topPos,this.lastImg.width,this.lastImg.height):this.disposalRestoreFromIdx=this.frames.getLength()-1},e.prototype._setFrame=function(t){var e,i,s;return s=this.frame.getImageData(t.leftPos,t.topPos,t.width,t.height),e=s.data,i=t.lctFlag?t.lct:this.hdr.gct,t.pixels.forEach(function(t){return function(s,a){return s!==t.transparency?(e[4*a+0]=i[s][0],e[4*a+1]=i[s][1],e[4*a+2]=i[s][2],e[4*a+3]=255):void 0}}(this)),s.data=e,this.frame.putImageData(s,t.leftPos,t.topPos)},e.prototype.eofHandler=function(){var t;return t=!1,this._pushFrame(),this._eofCallBack()},e.prototype._eofCallBack=function(){return this.canvas.setPlayer()},e.prototype.getPlayer=function(){return this.player},e.prototype._getHandlerwithDrawProgress=function(t){return function(e){return function(i){return t(i),e.canvas.drawProgress(e.stream.pos,e.stream.data.length)}}(this)},e}(),t=function(){function t(t){this.block=t,this.progress_height=5,this.frames=new e,this._init()}return t.prototype._init=function(){var t,e,i,s,a;return a=this.block.getAttribute("data-width"),e=this.block.getAttribute("data-height"),i=this.block.parentNode,t=document.createElement("div"),this.tmp_canvas=document.createElement("canvas"),this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=a,this.canvas.height=e,t.className="gifvideo",t.setAttribute("style","width:"+a+"px;height:"+e+"px"),s=document.createElement("ul"),this.li_play=document.createElement("li"),this.li_play.className="play",this.li_play.innerHTML="play",this.li_stop=document.createElement("li"),this.li_stop.className="stop",this.li_stop.innerHTML="stop",s.appendChild(this.li_play),s.appendChild(this.li_stop),t.appendChild(this.canvas),t.appendChild(s),i.insertBefore(t,this.block),i.removeChild(this.block)},t.prototype.setSize=function(t,e){return this.canvas.width=t,this.canvas.height=e,this.tmp_canvas.width=t,this.tmp_canvas.height=e,this.tmp_canvas.style.width=""+t+"px",this.tmp_canvas.style.height=""+e+"px",this.tmp_canvas.getContext("2d").setTransform(1,0,0,1,0,0)},t.prototype.drawFrame=function(t){var e;return e=this.frames.getFrame(t).data,this.tmp_canvas.getContext("2d").putImageData(e,0,0),this.ctx.drawImage(this.tmp_canvas,0,0)},t.prototype.drawError=function(t){var e,i;return console.log("drawError",t),i=[],e={width:this.block.width,height:this.block.height},this.ctx.fillStyle="black",this.ctx.fillRect(0,0,e.width,e.height),this.ctx.strokeStyle="red",this.ctx.lineWidth=3,this.ctx.moveTo(0,0),this.ctx.lineTo(e.width,e.height),this.ctx.moveTo(0,e.height),this.ctx.lineTo(e.width,0),this.ctx.stroke()},t.prototype.drawProgress=function(t,e){var i;return i={top:this.canvas.height-this.progress_height,mid:t/e*this.canvas.width,width:this.canvas.width,height:this.progress_height},this.ctx.fillStyle="#79bca5",this.ctx.fillRect(0,i.top,i.mid,i.height)},t.prototype.setPlayer=function(){var t;return t=new i(this,this.frames),this.li_play.onclick=function(){return t.play()},this.li_stop.onclick=function(){return t.stop()}},t}(),e=function(){function t(){this.frames=[]}return t.prototype.getLength=function(){return this.frames.length},t.prototype.getFrame=function(t){return this.frames[t]},t.prototype.addFrame=function(t){return this.frames.push({data:t.data,delay:t.delay})},t}(),i=function(){function t(t,e){this.canvas=t,this.frames=e,this._getDelay=s(this._getDelay,this),this._playLoop=s(this._playLoop,this),this.index=0,this.playing=!1,this.frames_len=this.frames.getLength()}return t.prototype.stop=function(){return this.playing=!1,this.index=0,this.canvas.drawFrame(this.index)},t.prototype.pause=function(){return this.playing=!1},t.prototype.play=function(){return this.playing=!0,this._playLoop()},t.prototype._playLoop=function(){var t;return this.playing?(this.drawFrameAfter(1),t=this._getDelay(),setTimeout(this._playLoop,t)):!0},t.prototype.drawFrameAfter=function(t){return this.index=(this.index+t+this.frames_len)%this.frames_len,this.canvas.drawFrame(this.index)},t.prototype._getDelay=function(){return 10*this.frames.getFrame(this.index).delay||100},t.prototype.moveTo=function(t){return this.index=t,this.canvas.drawFrame(this.index)},t}()}).call(this);